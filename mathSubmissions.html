<head>
    <title>Daily math problem</title>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-database.js"></script>

    <script id="firebase-config">
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyACEuS2m4oLG55gQuxqYbwraucq47Iz-LY",
            authDomain: "wsquarepams.firebaseapp.com",
            databaseURL: "https://wsquarepams.firebaseio.com",
            projectId: "wsquarepams",
            storageBucket: "wsquarepams.appspot.com",
            messagingSenderId: "61133214796",
            appId: "1:61133214796:web:bea87954f6231e0a2d50e9",
            measurementId: "G-8M5V3K0B8H"
        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        var database = firebase.database()
        document.getElementById("firebase-config").remove()
    </script>
    <style>
        button {
            border-style: solid;
            border-color: black;
            background-color: white;
        }

        button:hover {
            border-style: solid;
            border-color: black;
            background-color: gray;
            cursor: pointer
        }

    </style>
</head>

<body>
    <h1>Submit a math problem!</h1>
    <label for="question">Your question: </label><input id="question" type="text"> <br>
    <label for="answer">Answer to your question: </label><input id="answer" type="text"> <br>
    <label for="name">Your email: </label> <input id="name" type="email"> <br>
    <button onclick="submit()">Submit!</button> <br>
</body>
<script id="script">
    var currentId = 0

    function write(question, answer, email) {
        firebase.database().ref('userQuestions/' + currentId).set({
            question:question,
            answer: answer,
            email: email
        }, function (error) {
            if (error) {
                document.body.innerHTML = `Something went wrong. Try reloading the page <br>
                <button onclick="window.location.reload()">Reload Page</button>`
            } else {
                // Data saved successfully!
                document.body.innerHTML =
                    `Your question has been recorded. <br>
                <button onclick="window.location.href = 'dailyMath.html'">See today's question</button>`
            }
        });
    }

    function read() {
        database.ref('/userQuestions').on('value', function(snapshot) {
            var items = snapshot.val() || 0
            console.log(items)
            for (var i = 0; i < Object.keys(items).length; i++) {
                currentId = i + 1
            }
        })
    }

    function submit() {
        var question = document.getElementById("question").value
        var answer = document.getElementById("answer").value
        var name = document.getElementById("name").value
        if (answer == "" || name == "") {
            alert("Please fill in all fields.")
        } else {
            if (validateEmail(name)) {
                write(question, answer, name)
            }
        }
    }

    function validateEmail(email) {
        if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)) {
            localStorage.setItem("sender", splitEmail(email)) 
            return (true)
        }
        alert("You have entered an invalid email address!")
        return (false)
    }

    function splitEmail(email) {
        var nameParts = email.split("@");
        var name = nameParts.length == 2 ? nameParts[0] : null;
        return nameParts
    }
    read()
    document.getElementById("script").remove()
</script>
