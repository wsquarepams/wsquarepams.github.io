<head>
    <title>Daily math problem</title>
    <div id="firebase-app">
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-app.js"></script>

        <!-- TODO: Add SDKs for Firebase products that you want to use
            https://firebase.google.com/docs/web/setup#available-libraries -->
        <script src="https://www.gstatic.com/firebasejs/7.13.1/firebase-database.js"></script>

        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyACEuS2m4oLG55gQuxqYbwraucq47Iz-LY",
                authDomain: "wsquarepams.firebaseapp.com",
                databaseURL: "https://wsquarepams.firebaseio.com",
                projectId: "wsquarepams",
                storageBucket: "wsquarepams.appspot.com",
                messagingSenderId: "61133214796",
                appId: "1:61133214796:web:bea87954f6231e0a2d50e9",
                measurementId: "G-8M5V3K0B8H"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            var database = firebase.database()

        </script>
    </div>
    <style>
        button {
            border-style: solid;
            border-color: black;
            background-color: white;
        }

        button:hover {
            border-style: solid;
            border-color: black;
            background-color: gray;
            cursor:pointer
        }
    </style>
</head>
<body>
    <h1>Today's math problem: </h1>
    <p id="mathProblemDisplay" style="font-size: 25px;">Loading...</p>
    <label for="answer">Your answer: </label><input id="answer" type="text"> <br>
    <label for="name">Your nickname (Willy must know it though): </label> <input id="name" type="text"> <br>
    <button onclick="submit()">Submit!</button> <br>
</body>
<script id="script">
    var currentId = 0
    function write(answer, name) {
        firebase.database().ref('userAnswers/' + currentId).set({
            answer: answer,
            name: name
        }, function (error) {
            if (error) {
                // The write failed...
            } else {
                // Data saved successfully!
                localStorage.setItem("sender", document.getElementById("name").value)
                document.getElementById("answer").value = ""
                document.getElementById("name").value = ""
                document.body.innerHTML = `Your answer has been recorded. <br>
                <button onclick="window.location.href = 'lastDayAnswer.html'">See answer for yesterday's question</button>`
            }
        });
    }
    function read() {
        return firebase.database().ref('/mathQuestion/question').on('value', function(snapshot) {
            var question = (snapshot.val()) || 'There was no quesiton in the database.';
            document.getElementById("mathProblemDisplay").innerHTML = question
        });
    }

    function init() {
        return firebase.database().ref('/userAnswers').on('value', function(snapshot) {
            var answers = (snapshot.val()) || 0;
            try {
                currentId = Object.keys(answers).length
            } catch {
                currentId = 0
            }
            read()
        });
    }

    function submit() {
        var answer = document.getElementById("answer").value
        var name = document.getElementById("name").value
        if (answer == "" || name == "") {
            alert("Please fill in all fields.")
        } else {
            write(answer, name)
        }
    }
    init()
    document.getElementById("script").remove()
    document.getElementById("firebase-app").remove()
</script>
